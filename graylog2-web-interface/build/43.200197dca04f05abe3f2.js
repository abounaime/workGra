webpackJsonp([43],{1402:function(e,exports,t){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var d=t(2),n=a(d),o=t(1),s=a(o),i=t(15),r=t(258),l=t(269),u=a(l),c=t(18),h=a(c),f=t(952),m=a(f),p=t(5),g=a(p),b=t(75),D=a(b),E=t(48),k=t(165),w=a(k),v=t(957),I=a(v),_=t(1055),S=a(_),y=t(1206),U=a(y),B=t(1499),C=a(B),T=h.default.getStore("Streams"),A=h.default.getStore("CurrentUser"),F=h.default.getStore("Dashboards"),R=h.default.getStore("Focus"),H=h.default.getStore("Widgets"),P=n.default.createClass({displayName:"ShowDashboardPage",propTypes:{history:n.default.PropTypes.object.isRequired,params:n.default.PropTypes.object.isRequired},mixins:[s.default.connect(A),s.default.connect(R),w.default],getInitialState:function(){return{locked:!0,forceUpdateInBackground:!1,streamIds:null}},componentDidMount:function(){var e=this;this.loadData(),this.listenTo(H,this.removeWidget),T.load(function(t){var a=t.reduce(function(e,t){return e[t.id]=t.id,e},{});e.setState({streamIds:a})}),this.loadInterval=setInterval(this.loadData,2e3),this.setState({forceUpdateInBackground:this.state.currentUser.preferences.updateUnfocussed})},componentWillUnmount:function(){this.loadInterval&&clearInterval(this.loadInterval)},DASHBOARDS_EDIT:"dashboards:edit",DEFAULT_HEIGHT:1,DEFAULT_WIDTH:2,loadData:function(){var e=this,t=this.props.params.dashboardId;F.get(t).then(function(t){e.isMounted()&&(t.widgets.sort(function(e,t){return e.id.localeCompare(t.id)}),e.state.dashboard&&(0,u.default)(e.state.dashboard,t)||e.setState({dashboard:t}))},function(a){a.additional&&404===a.additional.status&&(g.default.error("Unable to find a dashboard with the id <"+t+">. Maybe it was deleted in the meantime."),e.props.history.pushState(null,D.default.DASHBOARDS))})},shouldUpdate:function(){return Boolean(this.state.forceUpdateInBackground||this.state.focus)},removeWidget:function(e){e.delete&&this.loadData()},emptyDashboard:function(){return n.default.createElement(i.Row,{className:"content"},n.default.createElement(i.Col,{md:12},n.default.createElement(i.Alert,{className:"no-widgets"},"This dashboard has no widgets yet. Learn how to add widgets in the ",n.default.createElement(I.default,{page:m.default.PAGES.DASHBOARDS,text:"documentation"}),".")))},_defaultWidgetDimensions:function(e){var t={col:0,row:0},a=r.PluginStore.exports("widgets").filter(function(t){return t.type.toUpperCase()===e.type.toUpperCase()})[0];return a?(t.height=a.defaultHeight,t.width=a.defaultWidth):(t.height=this.DEFAULT_HEIGHT,t.width=this.DEFAULT_WIDTH),t},_dashboardIsEmpty:function(e){return 0===e.widgets.length},_validDimension:function(e){return Number.isInteger(e)&&e>0},formatDashboard:function(e){var t=this;if(this._dashboardIsEmpty(e))return this.emptyDashboard();var a={};e.widgets.forEach(function(d){var n=e.positions[d.id]||{},o=t._defaultWidgetDimensions(d);a[d.id]={col:void 0===n.col?o.col:n.col,row:void 0===n.row?o.row:n.row,height:t._validDimension(n.height)?n.height:o.height,width:t._validDimension(n.width)?n.width:o.width}});var d=e.widgets.sort(function(e,t){var d=a[e.id],n=a[t.id];return d.col===n.col?d.row-n.row:d.col-n.col}).map(function(a){return n.default.createElement("div",{key:a.id,className:C.default.widgetContainer},n.default.createElement(U.default,{id:a.id,key:"widget-"+a.id,widget:a,dashboardId:e.id,locked:t.state.locked,shouldUpdate:t.shouldUpdate(),streamIds:t.state.streamIds}))});return n.default.createElement(i.Row,null,n.default.createElement("div",{className:"dashboard"},n.default.createElement(E.ReactGridContainer,{positions:a,onPositionsChange:this._onPositionsChange,locked:this.state.locked},d)))},_unlockDashboard:function(e){e.preventDefault(),this.state.locked&&this._toggleUnlock()},_toggleUnlock:function(){this.setState({locked:!this.state.locked})},_onPositionsChange:function(e){F.updatePositions(this.state.dashboard,e)},_toggleFullscreen:function(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},_toggleUpdateInBackground:function(){var e=!this.state.forceUpdateInBackground;this.setState({forceUpdateInBackground:e}),g.default.success("Graphs will be updated "+(e?"even":"only")+" when the browser is in the "+(e?"background":"foreground"),"")},render:function(){if(!this.state.dashboard)return n.default.createElement(E.Spinner,null);var e=this.state.dashboard,t=void 0;this._dashboardIsEmpty(e)||(t=n.default.createElement("div",null,n.default.createElement(i.Button,{id:"update-unfocussed",bsStyle:"info",onClick:this._toggleUpdateInBackground},"Update in ",this.state.forceUpdateInBackground?"foreground":"background")," ",n.default.createElement(i.Button,{className:"toggle-fullscreen",bsStyle:"info",onClick:this._toggleFullscreen},"Fullscreen"),n.default.createElement(E.IfPermitted,{permissions:this.DASHBOARDS_EDIT+":"+e.id}," ",n.default.createElement(i.Button,{bsStyle:"success",onClick:this._toggleUnlock},this.state.locked?"Unlock / Edit":"Lock"))));var a=void 0;this._dashboardIsEmpty(e)||(a=n.default.createElement(E.IfPermitted,{permissions:this.DASHBOARDS_EDIT+":"+e.id},n.default.createElement("div",{id:"drag-widgets-description"},"Drag widgets to any position you like in ",n.default.createElement("a",{href:"#",role:"button",onClick:this._unlockDashboard},"unlock / edit")," mode.")));var d=this.state.locked||this._dashboardIsEmpty(e)?null:n.default.createElement(S.default,{id:e.id,action:"edit",title:e.title,description:e.description,buttonClass:"btn-info btn-xs"},n.default.createElement("i",{className:"fa fa-pencil"})),o=n.default.createElement("span",null,n.default.createElement("span",{"data-dashboard-id":e.id,className:"dashboard-title"},e.title),"Â ",d);return n.default.createElement(E.DocumentTitle,{title:"Dashboard "+e.title},n.default.createElement("span",null,n.default.createElement(E.PageHeader,{title:o},n.default.createElement("span",{"data-dashboard-id":e.id,className:"dashboard-description"},e.description),a,t),this.formatDashboard(e),n.default.createElement("div",{className:"clearfix"})))}});exports.default=P,e.exports=exports.default},1432:function(e,exports,t){exports=e.exports=t(19)(),exports.push([e.i,"._3HrW10n1kzGWl5PDY4B2uD{background-color:#fff;border:1px solid #d1d1d1;z-index:auto}",""]),exports.locals={widgetContainer:"_3HrW10n1kzGWl5PDY4B2uD"}},1499:function(e,exports,t){var a=t(1432);"string"==typeof a&&(a=[[e.i,a,""]]);t(20)(a,{});a.locals&&(e.exports=a.locals)}});
//# sourceMappingURL=43.200197dca04f05abe3f2.js.map